<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dil Matkabƒ± Browser</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        /* ANA EKRAN */
        #home-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #000;
            z-index: 100;
            transition: opacity 0.3s;
        }

        #home-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .logo {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 30px;
        }

        .logo span {
            color: #0A84FF;
        }

        .search-box {
            width: 90%;
            max-width: 400px;
            height: 50px;
            background: #1C1C1E;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 0 15px;
            font-size: 17px;
            color: #fff;
        }

        /* TARAYICI EKRANI */
        #browser-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #browser-screen.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* √úST BAR */
        .top-bar {
            height: 60px;
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 10px;
            border-bottom: 1px solid #333;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            color: #0A84FF;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .url-display {
            flex: 1;
            height: 36px;
            background: rgba(118, 118, 128, 0.24);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 10px;
        }

        /* WEB G√ñR√úN√úM√ú */
        .webview-container {
            flex: 1;
            background: #fff;
            position: relative;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* ALT BAR */
        .bottom-bar {
            height: 70px;
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #333;
            padding-bottom: 10px;
        }

        /* YAN MEN√ú (DRILL) */
        #drill-sidebar {
            position: fixed;
            top: 0;
            left: -85%;
            width: 85%;
            height: 100%;
            background: #1C1C1E;
            z-index: 200;
            transition: left 0.3s;
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 20px rgba(0,0,0,0.5);
        }

        #drill-sidebar.open {
            left: 0;
        }

        .sidebar-header {
            height: 60px;
            background: #2C2C2E;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid #444;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 700;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        /* KLAS√ñR YAPISI */
        .folder-item {
            background: #2C2C2E;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .folder-header {
            display: flex;
            align-items: center;
            padding: 15px;
            cursor: pointer;
            user-select: none;
        }

        .folder-icon {
            font-size: 20px;
            margin-right: 10px;
        }

        .folder-name {
            flex: 1;
            font-size: 16px;
            font-weight: 500;
        }

        .folder-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: none;
            border: none;
            color: #0A84FF;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }

        .folder-children {
            padding-left: 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s;
        }

        .folder-item.expanded .folder-children {
            max-height: 2000px;
        }

        /* C√úMLE Lƒ∞STESƒ∞ */
        .sentence-list {
            background: #1A1A1C;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }

        .sentence-item {
            background: #2C2C2E;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .sentence-tr {
            color: #fff;
            margin-bottom: 5px;
        }

        .sentence-target {
            color: #0A84FF;
        }

        /* OYNATICI KONTROLLER */
        .player-controls {
            background: #0A84FF;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            display: none;
        }

        .player-controls.active {
            display: block;
        }

        .player-info {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .player-buttons {
            display: flex;
            gap: 10px;
        }

        .player-btn {
            flex: 1;
            height: 45px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .player-btn:active {
            background: rgba(255,255,255,0.3);
        }

        /* BUTONLAR */
        .add-btn {
            width: 100%;
            height: 45px;
            background: #0A84FF;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        /* MODAL */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1C1C1E;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .modal-input {
            width: 100%;
            height: 45px;
            background: #2C2C2E;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 0 15px;
            color: #fff;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .modal-textarea {
            width: 100%;
            height: 100px;
            background: #2C2C2E;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px;
            color: #fff;
            font-size: 16px;
            resize: none;
            margin-bottom: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-btn {
            flex: 1;
            height: 45px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .modal-btn.primary {
            background: #0A84FF;
            color: #fff;
        }

        .modal-btn.secondary {
            background: #2C2C2E;
            color: #fff;
        }

        /* OVERLAY */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 150;
            display: none;
        }

        #overlay.active {
            display: block;
        }
    </style>
</head>
<body>

    <!-- ANA EKRAN -->
    <div id="home-screen">
        <div class="logo">Dil<span>Matkabƒ±</span></div>
        <input type="text" class="search-box" id="search-input" placeholder="Ara veya web sitesi yaz...">
    </div>

    <!-- TARAYICI EKRANI -->
    <div id="browser-screen">
        <div class="top-bar">
            <button class="nav-btn" onclick="toggleSidebar()">üìö</button>
            <div class="url-display" id="url-display">google.com</div>
            <button class="nav-btn" onclick="reloadPage()">üîÑ</button>
        </div>
        
        <div class="webview-container">
            <iframe id="webview" src=""></iframe>
        </div>
        
        <div class="bottom-bar">
            <button class="nav-btn" onclick="goBack()">‚óÄ</button>
            <button class="nav-btn" onclick="goForward()">‚ñ∂</button>
            <button class="nav-btn" onclick="sharePage()">‚¨ÜÔ∏è</button>
            <button class="nav-btn" onclick="goHome()">üè†</button>
        </div>
    </div>

    <!-- YAN MEN√ú (DRILL) -->
    <div id="overlay" onclick="toggleSidebar()"></div>
    <div id="drill-sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">üß™ Dil Laboratuvarƒ±</span>
            <button class="nav-btn" onclick="toggleSidebar()">‚úï</button>
        </div>
        
        <div id="player-section" class="player-controls">
            <div class="player-info" id="player-info">Klas√∂r se√ßin...</div>
            <div class="player-buttons">
                <button class="player-btn" onclick="startPlaying()">‚ñ∂ PLAY</button>
                <button class="player-btn" onclick="stopPlaying()">‚èπ STOP</button>
            </div>
        </div>
        
        <div class="sidebar-content" id="folder-tree">
            <!-- Klas√∂rler buraya gelecek -->
        </div>
        <button class="add-btn" onclick="showAddFolderModal()">+ Yeni Klas√∂r</button>
    </div>

    <!-- MODAL: KLAS√ñR EKLE -->
    <div class="modal" id="add-folder-modal">
        <div class="modal-content">
            <div class="modal-title">Yeni Klas√∂r</div>
            <input type="text" class="modal-input" id="folder-name-input" placeholder="Klas√∂r adƒ± (√∂rn: Almanca)">
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">ƒ∞ptal</button>
                <button class="modal-btn primary" onclick="addFolder()">Olu≈ütur</button>
            </div>
        </div>
    </div>

    <!-- MODAL: C√úMLE EKLE -->
    <div class="modal" id="add-sentence-modal">
        <div class="modal-content">
            <div class="modal-title">Yeni C√ºmle</div>
            <textarea class="modal-textarea" id="sentence-tr-input" placeholder="T√ºrk√ße c√ºmle..."></textarea>
            <textarea class="modal-textarea" id="sentence-target-input" placeholder="Hedef dil c√ºmle..."></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">ƒ∞ptal</button>
                <button class="modal-btn primary" onclick="addSentence()">Kaydet</button>
            </div>
        </div>
    </div>

    <script>
        // VERƒ∞ YAPISI
        let folders = JSON.parse(localStorage.getItem('folders')) || [];
        let currentFolderId = null;
        let selectedFolderId = null;
        let isPlaying = false;
        let playInterval = null;
        let currentSentenceIndex = 0;
        let playStep = 0; // 0: T√ºrk√ße, 1: Bekle, 2: Hedef dil

        // Dƒ∞L ALGILAMA
        const languageMap = {
            'almanca': 'de-DE',
            'german': 'de-DE',
            'deutsch': 'de-DE',
            'ingilizce': 'en-US',
            'english': 'en-US',
            'ispanyolca': 'es-ES',
            'spanish': 'es-ES',
            'espa√±ol': 'es-ES',
            'fransizca': 'fr-FR',
            'french': 'fr-FR',
            'fran√ßais': 'fr-FR',
            'italyanca': 'it-IT',
            'italian': 'it-IT',
            'italiano': 'it-IT',
            'japonca': 'ja-JP',
            'japanese': 'ja-JP',
            'rusca': 'ru-RU',
            'russian': 'ru-RU',
            '√ßince': 'zh-CN',
            'chinese': 'zh-CN',
            'arap√ßa': 'ar-SA',
            'arabic': 'ar-SA'
        };

        function detectLanguage(folderName) {
            const name = folderName.toLowerCase();
            for (let key in languageMap) {
                if (name.includes(key)) {
                    return languageMap[key];
                }
            }
            return 'en-US'; // Varsayƒ±lan
        }

        // TARAYICI FONKSƒ∞YONLARI
        const homeScreen = document.getElementById('home-screen');
        const browserScreen = document.getElementById('browser-screen');
        const searchInput = document.getElementById('search-input');
        const webview = document.getElementById('webview');
        const urlDisplay = document.getElementById('url-display');

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadUrl(searchInput.value);
            }
        });

        function loadUrl(query) {
            let url = query.trim();
            if (!url) return;

            if (url.includes('.') && !url.includes(' ')) {
                if (!url.startsWith('http')) url = 'https://' + url;
            } else {
                url = 'https://www.google.com/search?q=' + encodeURIComponent(url);
            }

            homeScreen.classList.add('hidden');
            browserScreen.classList.add('active');
            webview.src = url;
            urlDisplay.textContent = url.replace('https://', '').replace('www.', '').split('/')[0];
        }

        function goHome() {
            homeScreen.classList.remove('hidden');
            browserScreen.classList.remove('active');
            webview.src = '';
            searchInput.value = '';
        }

        function goBack() { history.back(); }
        function goForward() { history.forward(); }
        function reloadPage() { webview.src = webview.src; }
        function sharePage() {
            const url = webview.src;
            if (navigator.share) {
                navigator.share({ url: url });
            } else {
                navigator.clipboard.writeText(url);
                alert('Link kopyalandƒ±!');
            }
        }

        // YAN MEN√ú
        const sidebar = document.getElementById('drill-sidebar');
        const overlay = document.getElementById('overlay');

        function toggleSidebar() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        // KLAS√ñR Sƒ∞STEMƒ∞
        function renderFolders() {
            const tree = document.getElementById('folder-tree');
            tree.innerHTML = '';
            folders.forEach(folder => {
                tree.appendChild(createFolderElement(folder));
            });
            saveFolders();
        }

        function createFolderElement(folder, level = 0) {
            const div = document.createElement('div');
            div.className = 'folder-item';
            div.style.marginLeft = (level * 10) + 'px';

            const header = document.createElement('div');
            header.className = 'folder-header';
            header.onclick = () => toggleFolder(div);

            const playBtn = folder.sentences && folder.sentences.length > 0 
                ? `<button class="action-btn" onclick="event.stopPropagation(); selectFolder('${folder.id}')">‚ñ∂Ô∏è</button>`
                : '';

            header.innerHTML = `
                <span class="folder-icon">üìÅ</span>
                <span class="folder-name">${folder.name}</span>
                <div class="folder-actions" onclick="event.stopPropagation()">
                    ${playBtn}
                    <button class="action-btn" onclick="showAddSentenceModal('${folder.id}')">‚ûï</button>
                    <button class="action-btn" onclick="addSubfolder('${folder.id}')">üìÇ</button>
                    <button class="action-btn" onclick="deleteFolder('${folder.id}')">üóëÔ∏è</button>
                </div>
            `;

            const children = document.createElement('div');
            children.className = 'folder-children';

            // C√ºmleler
            if (folder.sentences && folder.sentences.length > 0) {
                const sentenceList = document.createElement('div');
                sentenceList.className = 'sentence-list';
                folder.sentences.forEach(s => {
                    sentenceList.innerHTML += `
                        <div class="sentence-item">
                            <div class="sentence-tr">${s.turkish}</div>
                            <div class="sentence-target">${s.target}</div>
                        </div>
                    `;
                });
                children.appendChild(sentenceList);
            }

            // Alt klas√∂rler
            if (folder.children) {
                folder.children.forEach(child => {
                    children.appendChild(createFolderElement(child, level + 1));
                });
            }

            div.appendChild(header);
            div.appendChild(children);
            return div;
        }

        function toggleFolder(element) {
            element.classList.toggle('expanded');
        }

        function showAddFolderModal(parentId = null) {
            currentFolderId = parentId;
            document.getElementById('add-folder-modal').classList.add('active');
            document.getElementById('folder-name-input').value = '';
        }

        function addFolder() {
            const name = document.getElementById('folder-name-input').value.trim();
            if (!name) return;

            const newFolder = {
                id: Date.now().toString(),
                name: name,
                children: [],
                sentences: []
            };

            if (currentFolderId) {
                const parent = findFolder(folders, currentFolderId);
                if (parent) parent.children.push(newFolder);
            } else {
                folders.push(newFolder);
            }

            renderFolders();
            closeModal();
        }

        function addSubfolder(parentId) {
            showAddFolderModal(parentId);
        }

        function deleteFolder(id) {
            if (confirm('Bu klas√∂r√º silmek istediƒüinize emin misiniz?')) {
                folders = removeFolderById(folders, id);
                renderFolders();
            }
        }

        function removeFolderById(arr, id) {
            return arr.filter(f => {
                if (f.id === id) return false;
                if (f.children) f.children = removeFolderById(f.children, id);
                return true;
            });
        }

        function findFolder(arr, id) {
            for (let f of arr) {
                if (f.id === id) return f;
                if (f.children) {
                    const found = findFolder(f.children, id);
                    if (found) return found;
                }
            }
            return null;
        }

        // C√úMLE Sƒ∞STEMƒ∞
        function showAddSentenceModal(folderId) {
            currentFolderId = folderId;
            document.getElementById('add-sentence-modal').classList.add('active');
            document.getElementById('sentence-tr-input').value = '';
            document.getElementById('sentence-target-input').value = '';
        }

        function addSentence() {
            const tr = document.getElementById('sentence-tr-input').value.trim();
            const target = document.getElementById('sentence-target-input').value.trim();
            if (!tr || !target) return;

            const folder = findFolder(folders, currentFolderId);
            if (folder) {
                folder.sentences.push({ turkish: tr, target: target });
                renderFolders();
                closeModal();
            }
        }

        // OYNATICI Sƒ∞STEMƒ∞
        function selectFolder(folderId) {
            selectedFolderId = folderId;
            const folder = findFolder(folders, folderId);
            if (folder) {
                document.getElementById('player-section').classList.add('active');
                document.getElementById('player-info').textContent = `üìÅ ${folder.name} (${folder.sentences.length} c√ºmle)`;
            }
        }

        function startPlaying() {
            if (!selectedFolderId || isPlaying) return;
            
            const folder = findFolder(folders, selectedFolderId);
            if (!folder || !folder.sentences || folder.sentences.length === 0) {
                alert('Bu klas√∂rde c√ºmle yok!');
                return;
            }

            isPlaying = true;
            currentSentenceIndex = 0;
            playStep = 0;
            
            const targetLang = detectLanguage(getFolderPath(folder));
            playNextStep(folder, targetLang);
        }

        function playNextStep(folder, targetLang) {
            if (!isPlaying) return;

            const sentences = folder.sentences;
            if (currentSentenceIndex >= sentences.length) {
                currentSentenceIndex = 0; // Loop
            }

            const sentence = sentences[currentSentenceIndex];
            
            if (playStep === 0) {
                // T√ºrk√ße okuma
                document.getElementById('player-info').textContent = 
                    `üáπüá∑ ${sentence.turkish} (${currentSentenceIndex + 1}/${sentences.length})`;
                speak(sentence.turkish, 'tr-TR');
                playStep = 1;
                setTimeout(() => playNextStep(folder, targetLang), calculateWaitTime(sentence.turkish) + 500);
                
            } else if (playStep === 1) {
                // Bekleme
                document.getElementById('player-info').textContent = '‚è≥ Bekleniyor...';
                playStep = 2;
                setTimeout(() => playNextStep(folder, targetLang), 2000); // 2 saniye bekle
                
            } else if (playStep === 2) {
                // Hedef dil okuma
                document.getElementById('player-info').textContent = 
                    `üåç ${sentence.target} (${currentSentenceIndex + 1}/${sentences.length})`;
                speak(sentence.target, targetLang);
                playStep = 0;
                currentSentenceIndex++;
                setTimeout(() => playNextStep(folder, targetLang), calculateWaitTime(sentence.target) + 1000);
            }
        }

        function stopPlaying() {
            isPlaying = false;
            window.speechSynthesis.cancel();
            document.getElementById('player-info').textContent = '‚èπ Durduruldu';
        }

        function speak(text, lang) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.85;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function calculateWaitTime(text) {
            // Kelime sayƒ±sƒ±na g√∂re bekleme s√ºresi (her kelime ~400ms)
            const words = text.split(' ').length;
            return words * 400;
        }

        function getFolderPath(folder) {
            // Klas√∂r yolunu al (dil algƒ±lama i√ßin)
            return folder.name;
        }

        // MODAL Y√ñNETƒ∞Mƒ∞
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        // LOCALSTORAGE
        function saveFolders() {
            localStorage.setItem('folders', JSON.stringify(folders));
        }

        // ƒ∞LK Y√úKLEME
        renderFolders();
    </script>

</body>
</html>
