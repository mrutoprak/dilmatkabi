<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dil Matkabƒ± Browser</title>
    
    <style>
        /* === TEMEL AYARLAR === */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #000; color: #fff; overflow: hidden; height: 100vh; }

        /* ANA EKRAN */
        #home-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(135deg, #000000 0%, #1a1a2e 100%); z-index: 100; transition: opacity 0.3s;
        }
        #home-screen.hidden { opacity: 0; pointer-events: none; }
        .logo { font-size: 48px; font-weight: 700; margin-bottom: 30px; text-align: center; }
        .logo span { color: #0A84FF; }
        .search-container { width: 90%; max-width: 500px; }
        .search-box {
            width: 100%; height: 50px; background: #1C1C1E; border: 2px solid #333; border-radius: 12px;
            padding: 0 15px; font-size: 17px; color: #fff; transition: border-color 0.3s;
        }
        .search-box:focus { border-color: #0A84FF; outline: none; }
        .search-hint { text-align: center; color: #666; font-size: 14px; margin-top: 15px; }

        /* TARAYICI EKRANI */
        #browser-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #browser-screen.active { opacity: 1; pointer-events: auto; }

        /* √úST BAR */
        .top-bar {
            height: 60px; background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(20px);
            display: flex; align-items: center; padding: 0 10px; gap: 10px; border-bottom: 1px solid #333;
        }
        .nav-btn {
            min-width: 40px; height: 40px; background: none; border: none; color: #0A84FF;
            font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .url-display {
            flex: 1; height: 36px; background: rgba(118, 118, 128, 0.24); border-radius: 10px;
            display: flex; align-items: center; padding: 0 12px; color: #fff; font-size: 13px; overflow: hidden;
        }
        .url-text { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* WEB G√ñR√úN√úM√ú */
        .webview-container { flex: 1; background: #fff; position: relative; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }
        .loading-bar { position: absolute; top: 0; left: 0; height: 3px; background: #0A84FF; width: 0%; transition: width 0.3s; z-index: 10; }

        /* ALT BAR */
        .bottom-bar {
            height: 70px; background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #333; padding-bottom: 10px;
        }

        /* YAN MEN√ú (DRILL) */
        #drill-sidebar {
            position: fixed; top: 0; left: -85%; width: 85%; max-width: 350px; height: 100%;
            background: #1C1C1E; z-index: 200; transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; box-shadow: 5px 0 20px rgba(0,0,0,0.5);
        }
        #drill-sidebar.open { left: 0; }
        .sidebar-header {
            height: 60px; background: #2C2C2E; display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; border-bottom: 1px solid #444;
        }
        .sidebar-title { font-size: 18px; font-weight: 700; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 15px; }

        /* OYNATICI KONTROLLER */
        .player-controls {
            background: linear-gradient(135deg, #0A84FF, #0066CC); padding: 15px; margin: 0 15px 15px 15px;
            border-radius: 12px; display: none; /* Ba≈ülangƒ±√ßta gizli */
        }
        .player-controls.active { display: block; }
        .player-info {
            background: rgba(0,0,0,0.3); padding: 12px; border-radius: 8px; margin-bottom: 12px;
            font-size: 13px; line-height: 1.4; min-height: 40px; color: #fff;
        }
        .player-buttons { display: flex; gap: 10px; }
        .player-btn {
            flex: 1; height: 40px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px; color: #fff; font-size: 14px; font-weight: 600; cursor: pointer;
        }
        .player-btn.stop { background: rgba(255, 59, 48, 0.3); border-color: rgba(255, 59, 48, 0.5); }

        /* KLAS√ñR YAPISI */
        .folder-item { background: #2C2C2E; border-radius: 8px; margin-bottom: 8px; border: 1px solid #333; overflow: hidden; }
        .folder-header { display: flex; align-items: center; padding: 12px; cursor: pointer; transition: background 0.2s; }
        .folder-header:active { background: rgba(255,255,255,0.05); }
        .folder-icon { font-size: 20px; margin-right: 10px; }
        .folder-name { flex: 1; font-size: 15px; font-weight: 500; }
        .folder-actions { display: flex; gap: 5px; }
        .action-btn {
            background: none; border: none; color: #0A84FF; font-size: 16px; cursor: pointer;
            width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
            border-radius: 6px;
        }
        .action-btn:active { background: rgba(10, 132, 255, 0.2); }
        
        .folder-children { padding-left: 10px; display: none; } /* Kapalƒ± ba≈ülar */
        .folder-item.expanded > .folder-children { display: block; } /* A√ßƒ±lƒ±nca g√∂r√ºn√ºr */
        
        /* C√úMLE Lƒ∞STESƒ∞ */
        .sentence-list { background: #1A1A1C; padding: 5px; border-top: 1px solid #444; }
        .sentence-item {
            background: #252527; border-radius: 6px; padding: 10px; margin-bottom: 5px;
            font-size: 13px; border-left: 3px solid #444; transition: all 0.2s;
        }
        .sentence-item.playing { border-left-color: #32D74B; background: #1e3a23; } /* Oynatƒ±lan renk */
        
        .sentence-tr { color: #fff; margin-bottom: 4px; font-weight: 500; }
        .sentence-target { color: #0A84FF; font-family: monospace; }

        /* MODAL (Popup) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center;
            z-index: 300; padding: 20px;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: #1C1C1E; border-radius: 16px; padding: 20px; width: 100%; max-width: 350px;
            border: 1px solid #333;
        }
        .modal-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #fff; }
        .modal-input, .modal-textarea {
            width: 100%; background: #2C2C2E; border: 1px solid #444; border-radius: 8px;
            padding: 10px; color: #fff; font-size: 16px; margin-bottom: 10px;
        }
        .modal-buttons { display: flex; gap: 10px; margin-top: 15px; }
        .modal-btn {
            flex: 1; height: 44px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer;
        }
        .modal-btn.primary { background: #0A84FF; color: white; }
        .modal-btn.secondary { background: #333; color: white; }
        
        /* OVERLAY */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 150; display: none; backdrop-filter: blur(2px);
        }
        #overlay.active { display: block; }
        .add-main-btn { width: 100%; padding: 15px; background: #0A84FF; color: white; border: none; font-weight: bold; font-size: 16px; border-top: 1px solid #333; }
    </style>
</head>
<body>

    <!-- Gƒ∞Rƒ∞≈û EKRANI -->
    <div id="home-screen">
        <div class="logo">Dil<span>Matkabƒ±</span></div>
        <div class="search-container">
            <input type="text" class="search-box" id="search-input" placeholder="Site adresi veya arama..." autocomplete="off">
            <div class="search-hint">Google, Wikipedia veya bir kelime yazƒ±n</div>
        </div>
    </div>

    <!-- TARAYICI EKRANI -->
    <div id="browser-screen">
        <div class="top-bar">
            <button class="nav-btn" onclick="toggleSidebar()">üìö</button>
            <div class="url-display"><span class="url-text" id="url-display">google.com</span></div>
            <button class="nav-btn" onclick="reloadPage()">üîÑ</button>
        </div>
        <div class="webview-container">
            <div class="loading-bar" id="loading-bar"></div>
            <iframe id="webview" src=""></iframe>
        </div>
        <div class="bottom-bar">
            <button class="nav-btn" onclick="goBack()">‚óÄ</button>
            <button class="nav-btn" onclick="goForward()">‚ñ∂</button>
            <button class="nav-btn" onclick="sharePage()">‚¨ÜÔ∏è</button>
            <button class="nav-btn" onclick="goHome()">üè†</button>
        </div>
    </div>

    <!-- YAN MEN√ú (MATKAP) -->
    <div id="overlay" onclick="toggleSidebar()"></div>
    <div id="drill-sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">üß™ Dil Laboratuvarƒ±</span>
            <button class="nav-btn" onclick="toggleSidebar()">‚úï</button>
        </div>

        <!-- OYNATICI -->
        <div id="player-controls" class="player-controls">
            <div class="player-info" id="player-status">Hazƒ±r</div>
            <div class="player-buttons">
                <button class="player-btn" onclick="playFolder()">‚ñ∂ Oynat</button>
                <button class="player-btn stop" onclick="stopPlayer()">‚èπ Durdur</button>
            </div>
        </div>

        <div class="sidebar-content" id="folder-tree"></div>
        <button class="add-main-btn" onclick="showAddFolderModal()">+ Yeni Ana Klas√∂r</button>
    </div>

    <!-- MODALLER -->
    <div class="modal" id="add-folder-modal">
        <div class="modal-content">
            <div class="modal-title">Klas√∂r Olu≈ütur</div>
            <input type="text" class="modal-input" id="folder-name" placeholder="Klas√∂r Adƒ± (√∂rn: Almanca)">
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">ƒ∞ptal</button>
                <button class="modal-btn primary" onclick="confirmAddFolder()">Olu≈ütur</button>
            </div>
        </div>
    </div>

    <div class="modal" id="add-sentence-modal">
        <div class="modal-content">
            <div class="modal-title">C√ºmle Ekle</div>
            <textarea class="modal-textarea" id="sent-tr" placeholder="T√ºrk√ße: Yiyor musun?"></textarea>
            <textarea class="modal-textarea" id="sent-target" placeholder="Hedef: Isst du?"></textarea>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">ƒ∞ptal</button>
                <button class="modal-btn primary" onclick="confirmAddSentence()">Ekle</button>
            </div>
        </div>
    </div>

    <script>
        // --- VERƒ∞TABANI VE DEƒûƒ∞≈ûKENLER ---
        let folders = JSON.parse(localStorage.getItem('dm_folders')) || [];
        let currentFolderId = null; // ƒ∞≈ülem yapƒ±lan klas√∂r
        let activePlayerFolderId = null; // Oynatƒ±lan klas√∂r
        let isPlaying = false;
        let playIndex = 0;
        let playTimeout;
        let activeSentenceList = [];
        
        // Dil Tahmin Haritasƒ± (Klas√∂r adƒ±na g√∂re)
        const langMap = {
            'almanca': 'de-DE', 'german': 'de-DE', 'de': 'de-DE',
            'ingilizce': 'en-US', 'english': 'en-US', 'en': 'en-US',
            'ispanyolca': 'es-ES', 'spanish': 'es-ES', 'es': 'es-ES',
            'fransizca': 'fr-FR', 'french': 'fr-FR', 'fr': 'fr-FR',
            'japonca': 'ja-JP', 'japanese': 'ja-JP', 'jp': 'ja-JP',
            'rusca': 'ru-RU', 'russian': 'ru-RU', 'ru': 'ru-RU',
            'arap√ßa': 'ar-SA', 'arabic': 'ar-SA', 'ar': 'ar-SA'
        };

        // --- BA≈ûLANGI√á ---
        renderFolders();

        // --- TARAYICI MOTORU ---
        const homeScreen = document.getElementById('home-screen');
        const browserScreen = document.getElementById('browser-screen');
        const searchInput = document.getElementById('search-input');
        const webview = document.getElementById('webview');
        const urlDisplay = document.getElementById('url-display');
        const loadingBar = document.getElementById('loading-bar');

        searchInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') loadUrl(searchInput.value); });

        function loadUrl(val) {
            if(!val) return;
            let url = val.trim();
            // Google Arama veya URL kontrol√º
            if (!url.includes('.') || url.includes(' ')) {
                url = 'https://www.google.com/search?igu=1&q=' + encodeURIComponent(url);
            } else if (!url.startsWith('http')) {
                url = 'https://' + url;
            }
            
            homeScreen.classList.add('hidden');
            browserScreen.classList.add('active');
            loadingBar.style.width = '70%';
            webview.src = url;
            
            try { urlDisplay.textContent = new URL(url).hostname; } catch { urlDisplay.textContent = "Y√ºkleniyor..."; }
            
            webview.onload = () => { loadingBar.style.width = '100%'; setTimeout(()=>loadingBar.style.width='0', 300); };
        }

        function goHome() {
            browserScreen.classList.remove('active');
            homeScreen.classList.remove('hidden');
            webview.src = "";
            searchInput.value = "";
        }
        function goBack() { try{history.back()}catch(e){} }
        function goForward() { try{history.forward()}catch(e){} }
        function reloadPage() { webview.src = webview.src; }
        function sharePage() { navigator.clipboard.writeText(webview.src); alert("Link Kopyalandƒ±"); }

        // --- MEN√ú KONTROLLERƒ∞ ---
        const sidebar = document.getElementById('drill-sidebar');
        const overlay = document.getElementById('overlay');
        function toggleSidebar() { sidebar.classList.toggle('open'); overlay.classList.toggle('active'); }

        // --- KLAS√ñR Sƒ∞STEMƒ∞ (CRUD) ---
        function saveFolders() { localStorage.setItem('dm_folders', JSON.stringify(folders)); }

        function renderFolders() {
            const tree = document.getElementById('folder-tree');
            tree.innerHTML = "";
            if(folders.length === 0) {
                tree.innerHTML = "<div style='color:#666; text-align:center; margin-top:20px;'>Hen√ºz klas√∂r yok.<br>Yeni ekleyerek ba≈üla!</div>";
                return;
            }
            // Ana klas√∂rleri listele
            folders.forEach(f => tree.appendChild(createFolderEl(f, 0)));
        }

        function createFolderEl(folder, level) {
            const div = document.createElement('div');
            div.className = 'folder-item';
            if(level > 0) div.style.marginLeft = (level * 15) + "px"; // Girinti
            
            // Ba≈ülƒ±k √áubuƒüu
            const header = document.createElement('div');
            header.className = 'folder-header';
            header.onclick = (e) => { 
                // Tƒ±klayƒ±nca a√ß/kapa, eƒüer oynatƒ±cƒ± deƒüilse
                div.classList.toggle('expanded');
                // Oynatƒ±cƒ±yƒ± bu klas√∂re hazƒ±rla
                preparePlayer(folder);
            };

            const title = document.createElement('span');
            title.className = 'folder-name';
            title.textContent = (folder.children ? "üìÅ " : "üìÑ ") + folder.name;

            const actions = document.createElement('div');
            actions.className = 'folder-actions';
            
            // Ekle Butonu (+)
            const addBtn = document.createElement('button');
            addBtn.className = 'action-btn';
            addBtn.innerHTML = '+';
            addBtn.onclick = (e) => { e.stopPropagation(); showAddOptions(folder.id); };

            // Sil Butonu (x)
            const delBtn = document.createElement('button');
            delBtn.className = 'action-btn';
            delBtn.innerHTML = 'üóë';
            delBtn.style.color = '#F43F5E';
            delBtn.onclick = (e) => { e.stopPropagation(); deleteFolder(folder.id); };

            actions.appendChild(addBtn);
            actions.appendChild(delBtn);
            header.appendChild(title);
            header.appendChild(actions);
            div.appendChild(header);

            // ƒ∞√ßerik Alanƒ± (Alt klas√∂rler ve C√ºmleler)
            const childrenContainer = document.createElement('div');
            childrenContainer.className = 'folder-children';
            
            // Varsa c√ºmleleri listele
            if(folder.sentences && folder.sentences.length > 0) {
                const sentList = document.createElement('div');
                sentList.className = 'sentence-list';
                folder.sentences.forEach((s, idx) => {
                    const row = document.createElement('div');
                    row.className = 'sentence-item';
                    row.id = `sent-${folder.id}-${idx}`; // Oynatƒ±rken bulmak i√ßin ID
                    row.innerHTML = `<div class="sentence-tr">${s.tr}</div><div class="sentence-target">‚ûú ${s.target}</div>`;
                    // √áift tƒ±klayƒ±nca sil
                    row.ondblclick = () => deleteSentence(folder.id, idx);
                    sentList.appendChild(row);
                });
                childrenContainer.appendChild(sentList);
            }

            // Varsa alt klas√∂rleri listele
            if(folder.children && folder.children.length > 0) {
                folder.children.forEach(child => {
                    childrenContainer.appendChild(createFolderEl(child, level + 1));
                });
            }

            div.appendChild(childrenContainer);
            return div;
        }

        // --- VERƒ∞ EKLEME MANTIƒûI ---
        function showAddOptions(parentId) {
            // Kullanƒ±cƒ±ya sor: Alt klas√∂r m√º, c√ºmle mi?
            // Basitlik i√ßin: Eƒüer c√ºmle varsa c√ºmle ekle, yoksa modal a√ß sor (≈ûimdilik direkt soralƒ±m)
            if(confirm("Klas√∂r m√º ekleyeceksin (Tamam), C√ºmle mi (ƒ∞ptal)?")) {
                showAddFolderModal(parentId);
            } else {
                showAddSentenceModal(parentId);
            }
        }

        // Klas√∂r Ekleme
        function showAddFolderModal(parentId = null) {
            currentFolderId = parentId;
            document.getElementById('add-folder-modal').classList.add('active');
            document.getElementById('folder-name').focus();
        }
        
        function confirmAddFolder() {
            const name = document.getElementById('folder-name').value.trim();
            if(!name) return;
            
            const newFolder = { id: Date.now().toString(), name: name, children: [], sentences: [] };
            
            if(currentFolderId === null) {
                folders.push(newFolder); // Ana k√∂ke ekle
            } else {
                const parent = findFolder(folders, currentFolderId);
                if(parent) parent.children.push(newFolder);
            }
            
            saveFolders(); renderFolders(); closeModal();
            document.getElementById('folder-name').value = "";
        }

        // C√ºmle Ekleme
        function showAddSentenceModal(folderId) {
            currentFolderId = folderId;
            document.getElementById('add-sentence-modal').classList.add('active');
            document.getElementById('sent-tr').focus();
        }

        function confirmAddSentence() {
            const tr = document.getElementById('sent-tr').value.trim();
            const target = document.getElementById('sent-target').value.trim();
            if(!tr || !target) return;

            const parent = findFolder(folders, currentFolderId);
            if(parent) {
                if(!parent.sentences) parent.sentences = [];
                parent.sentences.push({ tr: tr, target: target });
                saveFolders(); renderFolders(); closeModal();
                document.getElementById('sent-tr').value = "";
                document.getElementById('sent-target').value = "";
            }
        }

        // Silme
        function deleteFolder(id) {
            if(confirm("Silmek istediƒüine emin misin?")) {
                // Recursive silme (k√∂kten veya daldan)
                const remove = (arr) => {
                    const idx = arr.findIndex(f => f.id === id);
                    if(idx > -1) { arr.splice(idx, 1); return true; }
                    for(let f of arr) { if(f.children && remove(f.children)) return true; }
                    return false;
                };
                remove(folders);
                saveFolders(); renderFolders();
            }
        }

        function deleteSentence(folderId, sentenceIndex) {
            if(confirm("Bu c√ºmleyi sil?")) {
                const folder = findFolder(folders, folderId);
                if(folder && folder.sentences) {
                    folder.sentences.splice(sentenceIndex, 1);
                    saveFolders(); renderFolders();
                }
            }
        }

        // Yardƒ±mcƒ±: ID ile klas√∂r bulma (Recursive)
        function findFolder(list, id) {
            for(let item of list) {
                if(item.id === id) return item;
                if(item.children) {
                    const res = findFolder(item.children, id);
                    if(res) return res;
                }
            }
            return null;
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        // --- OYNATICI MOTORU (THE ENGINE) ---
        function preparePlayer(folder) {
            // Eƒüer klas√∂rde c√ºmle varsa oynatƒ±cƒ±yƒ± g√∂ster
            if(folder.sentences && folder.sentences.length > 0) {
                activePlayerFolderId = folder.id;
                activeSentenceList = folder.sentences;
                document.getElementById('player-controls').classList.add('active');
                document.getElementById('player-status').innerHTML = `Se√ßili: <b>${folder.name}</b> (${folder.sentences.length} C√ºmle)<br>Dili tahmin etmeye √ßalƒ±≈üacaƒüƒ±m...`;
            } else {
                // C√ºmle yoksa gizle
                document.getElementById('player-controls').classList.remove('active');
            }
        }

        function startPlaying() {
            if(isPlaying) return;
            if(!activeSentenceList.length) return;
            
            isPlaying = true;
            playIndex = 0;
            document.querySelector('.player-btn').style.background = '#32D74B'; // Ye≈üil yap
            playLoop();
        }

        function stopPlayer() {
            isPlaying = false;
            clearTimeout(playTimeout);
            window.speechSynthesis.cancel();
            document.querySelector('.player-btn').style.background = '#0A84FF'; // Mavi yap
            document.getElementById('player-status').innerText = "Durduruldu.";
            // Renkleri temizle
            document.querySelectorAll('.sentence-item').forEach(el => el.classList.remove('playing'));
        }

        function playLoop() {
            if(!isPlaying) return;
            if(playIndex >= activeSentenceList.length) {
                playIndex = 0; // Ba≈üa sar (Sonsuz D√∂ng√º)
            }

            const item = activeSentenceList[playIndex];
            const trText = item.tr;
            const targetText = item.target;
            
            // G√∂rsel Vurgulama
            document.querySelectorAll('.sentence-item').forEach(el => el.classList.remove('playing'));
            const currentEl = document.getElementById(`sent-${activePlayerFolderId}-${playIndex}`);
            if(currentEl) {
                currentEl.classList.add('playing');
                currentEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // Durum G√ºncelle
            const statusBox = document.getElementById('player-status');
            
            // ADIM 1: T√ºrk√ße S√∂yle
            statusBox.innerText = `üîä T√ºrk√ße: ${trText}`;
            speak(trText, 'tr-TR', () => {
                
                // ADIM 2: Bekle (Gap Effect)
                // C√ºmle uzunluƒüuna g√∂re bekleme s√ºresi hesapla (kelime * 600ms + 2sn)
                const waitTime = (targetText.split(' ').length * 600) + 2000;
                statusBox.innerText = `‚è≥ Bekleniyor... (${Math.floor(waitTime/1000)}sn)`;
                
                playTimeout = setTimeout(() => {
                    if(!isPlaying) return;

                    // ADIM 3: Hedef Dili S√∂yle
                    statusBox.innerText = `üîä Hedef: ${targetText}`;
                    
                    // Dili bulmak i√ßin √ºst klas√∂r isimlerine bakmak lazƒ±m ama
                    // ≈üimdilik metinden tahmin edelim (daha kolay)
                    let targetLang = 'de-DE'; // Varsayƒ±lan
                    if(targetText.match(/[\u3000-\u309f]/)) targetLang = 'ja-JP';
                    else if(targetText.match(/[\u0400-\u04FF]/)) targetLang = 'ru-RU';
                    else if(targetText.match(/[\u0600-\u06FF]/)) targetLang = 'ar-SA';
                    else if(targetText.match(/[¬ø¬°√±]/)) targetLang = 'es-ES';

                    speak(targetText, targetLang, () => {
                        // ADIM 4: Sonraki C√ºmleye Ge√ß
                        playIndex++;
                        playTimeout = setTimeout(playLoop, 1000); // 1 sn ara ver
                    });

                }, waitTime);
            });
        }

        // Konu≈üma Fonksiyonu (Callback ile)
        function speak(text, lang, onEnd) {
            if(!isPlaying) return;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = lang;
            u.rate = 0.9; // Biraz yava≈ü ve net
            u.onend = onEnd;
            u.onerror = onEnd; // Hata olsa da devam et
            window.speechSynthesis.speak(u);
        }

    </script>
</body>
</html>
